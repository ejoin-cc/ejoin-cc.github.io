---
title: DDNS
---
# DDNS

## 前言

假如我们现在使用一台本地服务器并部署了一些服务，如果我们想要随时随地访问到服务器上的服务，需要一些额外的配置。

要想外部访问到本地服务器，这个服务器需要有 IP 地址来作为唯一标识。而 IPv4 数目较少，一般家庭内部的设备不能直接获取公网 IPv4，如果想要运行商提供的话，会额外有一些费用。IPv6 地址范围很大，一般现在的路由器都支持设备获取公网 IPv6。我们可以将域名解析到服务器的公网 IPv6 上，这样就可以随时随地通过域名访问服务。而服务器上的 IPv6 地址经常会发生变化，如果手动配置域名的解析记录很麻烦，可以使用 DDNS 来完成自动修改域名解析的行为。

## 前提

1. 服务器具有 IPv6 公网地址（可以通过桥接光猫，路由器打开 IPv6 开关实现，注意如果需要外网访问的话，需要调整 IPv6 防火墙）。
2. 拥有一个域名（下面使用阿里云域名，其他域名解析服务提供商配置方式类似）。

## 使用

### 获取 AccessKey

先登录[阿里云后台](https://ram.console.aliyun.com/users)，点击侧边栏中的「用户」。新创建一个 RAM 用户，给新创建的用户添加全部 DNS 操作权限。

然后回到用户列表页，点击新创建的用户名，创建 AccessKey，记录下创建出来的 AccessKey 和 AccessSecret。

### 部署 DDNS

> 阅读项目的官方文档了解更多细节：[Github 地址](https://github.com/jeessy2/ddns-go)

在目录下创建编辑 docker-compose.yml 文件：

``` yml
version: '3.9'
services:
  ddns-go:
    image: jeessy/ddns-go:latest
    container_name: ddns
    restart: always
    network_mode: "host"
    volumes:
      - ./data:/root
    ports:
      - 9876:9876
```

由于 ddns 需要读取宿主机的 IP 地址，为了方便这里直接使用 host 模式，此时 ports 没有什么意义，只是为了标记服务使用的端口。

然后执行 `docker-compose up -d` 启动服务，执行完成后，在内网浏览器打开 `http://[IP]:9876`，开始进行配置。

### 配置 DDNS

DDNS 的配置很简单直观，按照提示登录修改用户后可以按照如下描述进行配置：

1. 选择对应的域名服务提供商（阿里云）。
2. 填写 AccessKey。
3. 启用拥有的公网 IP 类型（这里我选择 IPv6）。
4. Domains 中填写要解析的域名，可以写入多个域名，也可以填写通配域名（如 *.example.com 等）。
5. Webhook 部分选填，用于通知域名解析的更新结果（域名更新成功或不成功时, 会回调填写的URL）。
6. DDNS 的配置不需要频繁改动，将禁止外网访问勾选会更加安全。

更多的配置细节可以查看 DDNS 的官方文档。

正确配置完之后就可以通过域名访问到服务器，但域名解析默认访问的是 80 和 443 端口，我们还需要其他服务来进行代理，才能正确通过域名访问到服务上，我们将在下一页描述 nginx proxy manager 的配置，它可以提供这项服务。